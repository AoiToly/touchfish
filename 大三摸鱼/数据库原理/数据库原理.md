# 第1章 数据库发展史

## 1.1 数据管理技术的发展

### 1.1.1 人工管理阶段

时间：20世纪50年代中期以前，计算机本身的水平较低。

硬件方面：计算机的运算速度低、内存容量小，外存还没有磁盘等直接存取的存储设备

软件方面：还没有操作系统，没有管理数据的软件。

**特点**：

1. 数据不保存在计算机内
2. 没有专用的软件对数据进行管理
3. 只有程序，没有文件的概念
4. 数据面向程序

### 1.1.2 文件系统阶段

时间：从20世纪50年代后期到60年代中期，计算机的硬件、软件都有了很大发展

硬件：有了磁盘、磁鼓等直接存取的存储设备

软件：有了操作系统，其中有专门管理数据的文件系统。

从处理方式讲，不仅有了文件批处理，而且能够联机实时处理。此时，计算机不仅用于科学计算，还大量用于管理。

<img src="数据库原理.assets/image-20211201223703591.png" alt="image-20211201223703591" style="zoom:67%;" />

**特点**：

1. 数据以文件形式长期保存在磁盘上
2. 数据的逻辑结构与物理结构有了区别
3. 文件组织多样化
4. 数据不再属于某个特定的程序，可以重复使用
5. 对数据的操作以记录为单位

<img src="数据库原理.assets/image-20211201223714129.png" alt="image-20211201223714129" style="zoom:67%;" />

### 1.1.3 文件系统的缺陷

**数据的冗余性**：文件之间缺乏联系，每个应用程序对应的文件中可能有重复存储的数据

**数据不一致性**：往往由数据冗余造成，文件更新时，相同的数据在不同文件中不一样。

**数据联系弱**：文件之间相互独立，缺乏联系

### 1.1.4 倒排文件系统阶段

倒排文件是索引文件的推广，每个字段提供单独的索引，方便用户检索，但数据的更新比较复杂和困难

## 1.2 数据库技术的产生和发展

### 1.2.1 数据库技术的产生

**IMS系统**

1968年IBM公司研制IMS系统，在IBM360/370机上运行。

**DBTG报告**

1969年CODASYL（美国数据系统语言协会）的DBTG小组出一份报告，即DBTG报告。

**E.F.Codd的文章**

E.F.Codd于1970年在美国计算机学会通信杂志发表一文。

### 1.2.2 数据库阶段的数据管理特点

1. 采用复杂的数据模型表示数据结构

   描述数据之间的关系，通过存取路径实现，面向整个应用系统

   数据库系统和传统文件系统的根本区别：数据库系统通过所有存取路径表示自然的数据联系

2. 有较高的数据独立性：物理独立性、逻辑独立性

   数据独立性：数据和程序分离，解耦

   物理数据独立性：物理结构的改变尽量不影响整体逻辑结构、用户的逻辑结构以及应用程序

   逻辑数据独立性：整体逻辑结构改变时，尽量不影响用户的逻辑结构及应用程序

3. 提供了方便的用户接口

4. 提供四个方面的数据控制功能

   并发控制、恢复、完整性、安全性

5. 数据操作灵活

<img src="数据库原理.assets/image-20211201224931993.png" alt="image-20211201224931993" style="zoom:67%;" />

### 1.2.3 数据库技术的术语

**数据库（DB）**：

是统一管理的相关数据的集合。

**数据库管理系统（DBMS）**：

是位于用户与操作系统之间的一层数据管理软件，为用户和应用程序提供访问DB的方法，包括DB的建立、查询、更新及各种数据控制。

**数据库系统（DBS）**：

是实现有组织地、动态地存储大量关联数据，方便多用户的计算机软件、硬件和数据资源组成的系统，即采用了数据库技术的计算机系统。

**数据库技术**：

是一门研究数据库的结构、存储、管理和使用的软件学科。

### 1.2.4 数据库技术的发展

分布式数据库技术（区块链）

面向对象数据库技术

数据仓库

云数据库（Amazon AWS）

大数据（5V）

其他数据库技术

# 第2章 数据库系统结构

## 2.1 数据描述

### 2.1.1 概念设计中的数据描述

概念设计：根据用户的需求设计数据库的概念结构

**实体(Entity)**

实体是客观存在、可以相互区分的事物，既可以是实际存在的对象，也可以是某种概念。例如：一个工厂、一个车间、一种操作流程等。

**属性(Attribute)**

事物是有特性的。反映在实体上，就是实体的属性。一个实体具有有限个属性，也可以说是这些属性的总和组成了这个实体。

**实体集(Entityset)**

所有属性名完全相同的实体往往集合在一起，称为实体集。例如：全体职工就是一个实体集。为了区分实体集，每个实体集都有一个名称，即实体名。。

**实体标识符(Identifier)**

能惟一标识实体的属性或属性集。也称关键码，或键。

### 2.1.2 逻辑设计中的数据描述

逻辑设计：根据概念设计得到的概念结构来设计的数据库逻辑结构，即表达方式和实现方法

**字段（Field）**

标记实体属性的命名单位。也称数据项。

**记录（Record）**

字段的有序集合。

**文件（File）**

同一类记录的集合。

**关键码（Key）**

能惟一标识文件中每个记录的字段。

![image-20211201230929836](数据库原理.assets/image-20211201230929836.png)

### 2.1.3 存储介质层次及数据描述

**物理存储介质层次**：

高速缓冲存储器

主存储器

快擦写存储器（快闪存）

磁盘存储器

光存储器

磁带

**物理存储中的数据描述**：位、字节、字、块、桶、卷

### 2.1.4 数据联系的描述

实体集内部（实体和实体之间）的联系

实体间的联系有三种：

1. 同一实体集中各实体之间的联系(一元联系)。

2. 两个实体集中各实体之间的联系(两元联系)。
3. 三个实体集中各实体之间的联系(三元联系)。

二元联系的实体间联系有三种情况：

1. 一对一 （1：1）
2. 一对多 （1：N）
3. 多对多 （M：N）

## 2.2 数据模型

### 2.2.1 数据模型的定义

数据模型分两种：

1. 概念数据模型：用于建立信息世界的数据模型，与硬件、DBMS无关，实现方法是“实体联系模型”。（用户观点）
2. 结构（逻辑）数据模型：直接面向数据库的逻辑结构，与硬件、DBMS有关，有三部分构成：**数据结构**、**数据操作**、**数据完整性约束**

**数据结构**是指对实体类型和实体间联系的表达和实现。

**数据操作**是指对数据库的检索和更新（包括插入、删除和修改〉两类操作。

**数据完整性约束**给出数据及其联系应具有的制约和依赖规则。

### 2.2.2 实体联系模型

P.P.S.Chen（陈品山）于1976年提出的“实体―联系模型” （Entity―Relationship Approach,简称E―R模型）

ER图中四个基本成分：

1. **矩形框：表示实体类型**

2. **菱形框：表示联系类型**

3. **椭圆形框：表示实体类型或联系类型的属性**

4. **连线：实体与属性之间、实体与联系之间**

多元联系：两个及以上实体集之间的联系

![image-20211202115641372](数据库原理.assets/image-20211202115641372.png)

自身联系：在一个联系中,一个实体集可以出现两次或多次, 扮演多个不同角色, 此种情况称为实体集的自身联系。

![image-20211202115850591](数据库原理.assets/image-20211202115850591.png)

### 2.2.3 层次模型

用**树**形（层次）结构表示实体类型及实体间联系的数据模型称为**层次模型**。

树的结点是记录类型，每个非根结点有且只有一个父节点，上一层和下一层记录类型之间的联系是1:N联系

**特点**：

1. 有且仅有一个结点无父结点,这样的结点称为根结点；
2. 非根结点都有且仅有一个父结点。
3. 记录之间的联系通过**指针**实现，查询效率高

**优点**：

1. 查询效率高
2. 用户面对逻辑数据，不必过多考虑物理细节，逻辑与物理数据的转换由DBMS完成

**缺点**：

1. 只能表示1:N联系，M:N联系实现复杂，用户不易掌握
2. 层次顺序严格和复杂，导致数据的查询和更新操作复杂，使程序编写复杂

### 2.2.4 网状模型

用有向**图**结构表示实体类型及实体间联系的数据模型称为**网状模型**。

有向图中的结点是记录类型，箭头表示从箭尾的记录类型到箭头的记录类型间的联系是1:N联系

换句话说：把层次模型的限制放开： 一个结点可以有一个以上的父结点, 就得到网状模型。

**特点**：

1. 可能有一个以上的结点无父结点
2. 结点与其父结点之间的联系可以不止一个
3. 记录之间的联系通过**指针**实现，查询效率高

**缺点**：数据结构复杂和编程复杂

### 2.2.5 关系模型

关系模型的主要特征是用二维**表**格表达实体集。

**特点**：数据结构是**表格**，记录之间的联系通过模式的键体现

### 2.2.6 面向对象模型

面向对象模型是一种可扩充的数据模型,在该数据模型中,数据模型是可扩充的,即用户可根据需要,自己定义新的数据类型及相应的约束和操作**。

基本的概念是对象和类

**对象**：对象是面向对象数据模型的基本结构,是面向对象数据库系统的核心。 一个对象是由一些数据以及能够作用在这些数据上的操作组成。 例如,一个职工对象,将包含与职工相关的数据（职工号、 姓名、 性别、 职称、 部门等）以及能够在这些职工数据上进行的操作（增加职工、 删除职工、改变职称等等）。

**类**：在组织信息时,人们总是将具有相似特性的对象归为一类。 类中的每个对象称为类的一个实例（Instance）。 一个类中的所有对象其特性必须相同,即具有相同的属性、 响应相同的消息、 使用相同的方法。

如果说类的概念相当于关系模型中的关系模式,那么类的实例类似于元组,类的实例之间和类之间可以有复杂的联系。

## 2.3 数据库的体系结构

### 2.3.1 三级模式结构

数据的三级模式结构包含有外模式、模式和内模式。

![image-20211202134527810](数据库原理.assets/image-20211202134527810.png)

### 2.3.2 三级结构和两级映像

#### 三级结构

**模式**（Schema）

​	模式也称概念模式，是数据库中全体数据在逻辑上的视图。

​	不涉及到存储结构、访问技术等细节，以达到物理数据独立性。

**外模式**（External Schema）

​	外模式也称子模式，是个别用户的数据视图，即个别用户涉及到的数据的逻辑结构。

**内模式**（Internal Schema）

​	内模式也称存储模式。它既定义了数据库中全部数据的物理结构，还定义了数据的存储方法、存取策略等。

#### 二级映像

**外模式/模式映像**：存在于外部级与概念级之间，用于定义外模式和概念模式之间的对应性

**模式/内模式映像**：存在于概念级和内部级之间，用于定义概念模式和内模式之间的对应性

在外模式与模式之间通过外模式/模式映象进行转换。当模式改变时，只要相应改变外模式/模式映象，可使外模式保持不变。在模式与内模式之间通过模式/内模式映象进行转换。

### 2.3.3 两级数据独立性

**数据独立性**：应用程序和数据库的数据结构之间相互独立，不受影响

分为**物理数据独立性**和**逻辑数据独立性**

当数据库的存储结构改变时，只要相应改变模式/内模式映象，可使模式保持不变，从而，外模式也可保持不变。这二级转换使数据库系统的数据具有较高的逻辑独立性和物理独立性。

### 2.3.4 用户及用户界面

用户是指使用数据库的应用程序或联机终端用户。

编写应用程序的语言是高级程序设计语言，称为主语言。

DBMS还提供数据操纵语言DML。

## 2.4 数据库管理系统

### 2.4.1 DBMS的工作模式

接受应用程序的数据请求和处理请求

将用户的数据请求（高级指令）转换成复杂的机器代码（底层指令）

实现对数据库的操作

从对数据库的操作中接受查询结果

对查询结果进行处理（格式转换）

将处理结果返回给用户

![image-20211202152250570](数据库原理.assets/image-20211202152250570.png)

![image-20211202152337297](数据库原理.assets/image-20211202152337297.png)

### 2.4.2 DBMS的主要功能

**数据库的定义功能**

DBMS提供DDL来定义模式、外模式和内模式

**数据库的操纵功能**

DBMS应提供数据操纵语言（DML）供用户对数据库中的数据进行检索、修改、删除以及插入工作。

**数据库的保护功能**

数据库的恢复、并发控制、完整性、安全性

**数据库的维护功能**

**数据字典DD**

### 2.4.3 DBMS的模块组成

两大模块：查询处理器和存储管理器

**查询处理器**

DML编译器、嵌入型DML的预编译器、DML编译器、查询运行核心程序。

**存储管理器** 

授权和完整性管理器、事务管理器、文件管理器、缓冲区管理器。

## 2.5 数据库系统

**数据库**

物理数据库，描述数据库。

**硬件**

计算机硬件，存储设备。

**软件**

DBMS、OS、各种宿主语言和应用开发支撑软件。

**数据库管理员（DBA）**

控制数据整体结构，负责DBS的正常运行。

DBA的**职责**：

1. 定义模式
2. 定义内模式
3. 与用户的联络（定义外模式、应用程序设计、提供技术培训等专业服务）
4. 定义安全性规则，对用户访问数据库的授权
5. 定义完整性规则，监督数据库的运行
6. 数据库的转储与恢复工作

DBA的工具：DD系统和一系列实用程序

### 2.5.2 DBS的全局结构

**数据库用户**

DBA、专业用户、应用程序员、最终用户。

**DBMS的查询处理器**

DML编译器、嵌入型DML的预编译器、DDL编译器、查询运行核心程序。

**DBMS的存储管理器**

授权和完整性管理器、事务管理器、文件管理器、缓冲区管理器。

**磁盘存储器中的数据结构**

数据文件、数据字典、索引文件、统计数据、日志

### 2.5.3 DBS结构的分类

**集中式DBS**

**客户/服务器式DBS**

**并行式DBS**

**分布式DBS**

### 2.5.4 DBS的效益

**灵活性**

**简易性**

**面向用户**

**有效的数据控制**

**加快应用系统的开发速度**

**程序设计方便可维护性**

**标准化**

# 第4章 结构化查询语言SQL

## 4.1 SQL概述

### 4.1.1 SQL发展历程

SQL(Structured Query Language)语言是1974年提出的在IBM公司的System R上实现。

是介于关系代数和关系演算之间的语言。

1986年ANSI批准SQL作为关系数据库语言的美国标准，同年，ISO也同样决定。

以后相继出现SQL89，SQL2（1992），SQL3（1999）。

### 4.1.2 SQL数据库的体系结构

![image-20211202133258784](数据库原理.assets/image-20211202133258784.png)

**SQL**支持数据库的三级模式结构，如上图所示。从图中可以看出，模式与基本表相对应，外模式与视图相对应，内模式对应于存储文件。基本表和视图都是关系。

1. **基本表**（Base Table）

   基本表是模式的基本内容。每个基本表都是一个实际存在的关系。

2. **视图**（View)

   视图是外模式的基本单位，用户通过视图使用数据库中基于基本表的数据（基本表也可作为外模式使用）。

   视图是虚表，实际并不存在，只有定义存放在数据字典中。

3. **存储文件**

   存储文件是内模式的基本单位。每一个存储文件存储一个或多个基本表的内容。一个基本表可有若干索引，索引也存储在存储文件中。存储文件的存储结构对用户是透明的。

### 4.1.3 SQL的组成

数据定义DDL：CREATE、DROP、ALTER

数据操纵DML：

​	数据查询DQL：SELECT

​	数据操纵DML：INSERT、DELETE、UPDATE

数据控制DCL：GRANT、REVOKE

嵌入式SQL

## 4.2 SQL的数据定义（DDL）

模式，即**数据库**

**注意，模板中的“<>”、“[]”为无用内容，即不需要输入**

### 4.2.1 SQL模式的创建和撤销

SQL模式的创建

```sql
CREATE SCHEMA <模式名> AUTHORIZATION <用户名>
```

SQL模式的撤消

```sql
DROP SCHEMA　<模式名> [CASCADE|RESTRICT]
```

### 4.2.2 SQL提供的基本数据类型

各具体DBMS所提供的数据类型是不同的。但下面的数据类型几乎都是支持的：

INT或INTEGER    全字长二进制整数

SMALLINT       半字长二进制整数

DEC(p［,q］)或压缩十进制数，共p位，其中小数点后有q位

FLOAT              双字长的浮点数

CHAR(n)或CHARTER(n) 长度为n的定长字符串

VARCHAR(n)        最大长度为n的变长字符串

DATE       日期型，格式为YYYY―MM―DD

TIME        时间型，格式为HH.MM.SS

### 4.2.3 基本表的创建、修改和撤销

#### 基本表的创建——CREATE TABLE

```sql
CREATE TABLE <表名>
(<列名1> <类型> [<该列的完整性约束>]，
 <列名2> <类型> [ <该列的完整性约束>]]…
[<表级完整性约束>］)
```

<该列的完整性约束>：该列上数据必须符合的条件。最常见的有：

​	NOT NULL       该列值不能为空

​	NULL           该列值可以为空

​	UNIQUE         该列值不能有相同者

​	DEFAULT        该列上某值未定义时的默认值

<表级完整性约束>：对整个表的一些约束条件，常见的有定义主码(外码)，各列上数据必须符合的关联条件等。

#### 基本表结构的修改——ALTER TABLE

基本表的结构是可以随环境的变化而修改的，即根据需要增加、修改或删除其中一列(或完整性约束条件等)。

```sql
ALTER TABLE<表名>
[-ADD <列名> <数据类型> [完整性约束]]
[DROP <列名>]
[MODIFY <列名> <数据类型>[完整性约束]]
```

#### 基本表的撤消——DROP TABLE

```sql
DROP TABLE <表名> [CASCADE|RESTRICT]
```

此语句一执行，指定的表即从数据库中删除（表被删除，表在数据字典中的定义也被删除），此表上建立的索引和视图也被自动删除(有些系统对建立在此表上的视图的定义并不删除，但也无法使用了)。

### 4.2.4 索引的创建和撤消

#### 索引的建立——CREATE INDEX

在一个基本表上，可建立若干索引。有了索引，可以加快查询速度。索引的建立和删除工作由DBA或表的属主(建表人)负责。用户在查询时并不能选择索引，选择索引的工作由DBMS自动进行。

```sql
CREATE[UNIQUE]INDEX <索引名>
ON <表名> ( <列名> [ASC|DESC])…
本语句为规定<表名>建立一索引，索引名为<索引名>。
```

#### 删除索引——DROP INDEX

索引太多，索引的维护开销也将增大。因此，不必要的索引应及时删除。

```sql
DROP INDEX <索引名>
本语句将删除规定的索引。该索引在数据字典中的描述也将被删除。
```

